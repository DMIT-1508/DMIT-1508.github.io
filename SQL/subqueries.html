<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subqueries | DMIT-1508 Student Notes</title>
    <meta name="description" content="Database Fundamentals">
    
    
    <link rel="preload" href="/assets/css/0.styles.16c91a8c.css" as="style"><link rel="preload" href="/assets/js/app.7cc1c6fa.js" as="script"><link rel="preload" href="/assets/js/26.3cf4d3e8.js" as="script"><link rel="prefetch" href="/assets/js/12.8784c0b6.js"><link rel="prefetch" href="/assets/js/1.26b2f2eb.js"><link rel="prefetch" href="/assets/js/2.5b00d24e.js"><link rel="prefetch" href="/assets/js/3.e3051415.js"><link rel="prefetch" href="/assets/js/4.82cbe38f.js"><link rel="prefetch" href="/assets/js/5.2aef8f8f.js"><link rel="prefetch" href="/assets/js/6.0018577b.js"><link rel="prefetch" href="/assets/js/7.2c9419d0.js"><link rel="prefetch" href="/assets/js/8.0eb354d8.js"><link rel="prefetch" href="/assets/js/9.5c7ea3ba.js"><link rel="prefetch" href="/assets/js/10.7a78657d.js"><link rel="prefetch" href="/assets/js/11.386bfc4e.js"><link rel="prefetch" href="/assets/js/13.07bc4119.js"><link rel="prefetch" href="/assets/js/14.41042eb0.js"><link rel="prefetch" href="/assets/js/15.051ed0d4.js"><link rel="prefetch" href="/assets/js/16.a0fdb65a.js"><link rel="prefetch" href="/assets/js/17.15755b52.js"><link rel="prefetch" href="/assets/js/18.99f64c83.js"><link rel="prefetch" href="/assets/js/19.411ad124.js"><link rel="prefetch" href="/assets/js/20.ad60d1b3.js"><link rel="prefetch" href="/assets/js/21.39d9e647.js"><link rel="prefetch" href="/assets/js/22.a8cf92a4.js"><link rel="prefetch" href="/assets/js/23.54b7233a.js"><link rel="prefetch" href="/assets/js/24.35603478.js"><link rel="prefetch" href="/assets/js/25.659ee38a.js"><link rel="prefetch" href="/assets/js/27.bbc973fe.js"><link rel="prefetch" href="/assets/js/28.e6f66516.js"><link rel="prefetch" href="/assets/js/29.fc245e45.js"><link rel="prefetch" href="/assets/js/30.65f529cf.js"><link rel="prefetch" href="/assets/js/31.86e4337b.js"><link rel="prefetch" href="/assets/js/32.37a4c069.js"><link rel="prefetch" href="/assets/js/33.ecad6148.js"><link rel="prefetch" href="/assets/js/34.ce31c0b8.js"><link rel="prefetch" href="/assets/js/35.72931302.js"><link rel="prefetch" href="/assets/js/36.58738107.js"><link rel="prefetch" href="/assets/js/37.37e86178.js"><link rel="prefetch" href="/assets/js/38.e446cb61.js"><link rel="prefetch" href="/assets/js/39.470969e2.js"><link rel="prefetch" href="/assets/js/40.cbf3eddc.js"><link rel="prefetch" href="/assets/js/41.a7331d81.js"><link rel="prefetch" href="/assets/js/42.468801c7.js"><link rel="prefetch" href="/assets/js/43.a682d283.js"><link rel="prefetch" href="/assets/js/44.a85b3bcb.js"><link rel="prefetch" href="/assets/js/45.9a055c11.js"><link rel="prefetch" href="/assets/js/46.dbb14da3.js"><link rel="prefetch" href="/assets/js/47.a6711911.js"><link rel="prefetch" href="/assets/js/48.dadf1c65.js"><link rel="prefetch" href="/assets/js/49.dbbbb4af.js"><link rel="prefetch" href="/assets/js/50.06017c64.js"><link rel="prefetch" href="/assets/js/51.2f85c7d6.js"><link rel="prefetch" href="/assets/js/52.f575ae7a.js"><link rel="prefetch" href="/assets/js/53.47e57bd6.js"><link rel="prefetch" href="/assets/js/54.53874c87.js"><link rel="prefetch" href="/assets/js/55.29d29f20.js"><link rel="prefetch" href="/assets/js/56.39f83668.js"><link rel="prefetch" href="/assets/js/57.c68ff785.js">
    <link rel="stylesheet" href="/assets/css/0.styles.16c91a8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DMIT-1508 Student Notes</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Design/" class="nav-link">Normalization</a></div><div class="nav-item"><a href="/DDL/" class="nav-link">DDL</a></div><div class="nav-item"><a href="/DML/" class="nav-link">DML</a></div><div class="nav-item"><a href="/SQL/" class="nav-link router-link-active">SQL</a></div><div class="nav-item"><a href="/DCL/" class="nav-link">DCL</a></div><div class="nav-item"><a href="/about/slides-installing-sql-server.html" class="nav-link">MS SQL 2017</a></div><div class="nav-item"><a href="https://github.com/DMIT-1508/DMIT-1508.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Design/" class="nav-link">Normalization</a></div><div class="nav-item"><a href="/DDL/" class="nav-link">DDL</a></div><div class="nav-item"><a href="/DML/" class="nav-link">DML</a></div><div class="nav-item"><a href="/SQL/" class="nav-link router-link-active">SQL</a></div><div class="nav-item"><a href="/DCL/" class="nav-link">DCL</a></div><div class="nav-item"><a href="/about/slides-installing-sql-server.html" class="nav-link">MS SQL 2017</a></div><div class="nav-item"><a href="https://github.com/DMIT-1508/DMIT-1508.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/SQL/" class="sidebar-link">Simple SQL Queries</a></li><li><a href="/SQL/simpleQueries.html" class="sidebar-link">SIMPLE QUERY</a></li><li><a href="/SQL/stringFunctions.html" class="sidebar-link">String Functions</a></li><li><a href="/SQL/dateFunctions.html" class="sidebar-link">Date Functions</a></li><li><a href="/SQL/aggregateFunctions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/SQL/aggregateGroupBy.html" class="sidebar-link">Aggregates and Non-Aggregates</a></li><li><a href="/SQL/innerJoins.html" class="sidebar-link">Inner Joins</a></li><li><a href="/SQL/outerJoins.html" class="sidebar-link">Outer Joins</a></li><li><a href="/SQL/subqueries.html" class="active sidebar-link">Subqueries</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SQL/subqueries.html#subqueries-2" class="sidebar-link">SUBQUERIES</a></li></ul></li><li><a href="/SQL/unions.html" class="sidebar-link">Unions</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="subqueries"><a href="#subqueries" aria-hidden="true" class="header-anchor">#</a> Subqueries</h1> <ul><li>Subqueries Overview</li> <li>Subqueries vs. Joins (with examples)</li> <li>Subqueries Required (with examples)</li> <li>Practice</li> <li>Practice Solution</li></ul> <hr> <h2 id="subqueries-2"><a href="#subqueries-2" aria-hidden="true" class="header-anchor">#</a> SUBQUERIES</h2> <p>A subquery is a SELECT statement that is nested inside another statement. It is a full and complete select statement and can execute on its own. We will first look at subqueries as a Select statement inside another select statement. Subqueries are used in the where or having clause to identify the records that need to be returned.</p> <p>We often refer to the subquery portion (nested inside the other select) as the inner query and the Select statement around it as the Outer Query.</p> <p>There are two types of subqueries. They are Nested and Correlated. In this course we focus on Nested subqueries only.</p> <p>Let's take a look at the following Select statement that uses a subquery:</p> <p>[[code quote]]</p> <p>The subquery (inner query) executes one and returns on or more values and then the outer query executes using the value(s) returned from the subquery.</p> <p>[[code quote]]</p> <p>Inner query (subquery) executes first and returns value(s)</p> <p>[[code quote]]</p> <p>The outer query then executes using the results of the subquery as criteria for the where clause. The results of the Select executing are:</p> <p>StaffFirstName</p> <p>StaffLastName</p> <p>Hugh</p> <p>Guy</p> <p>This was a two step solution where first the subquery returned the PositionID for the PositionDescription of 'Dean' and then Selected all the Staff Names that had that PositionID.</p> <p>It is important to note that this example used an = in front of the subquery. If our subquery had returned more than one value it would have cause an error when the statement was executed. You can only compare one value to another one value when using an = operator.</p> <p>What if the subquery returns multiple values?</p> <p>One of the most common uses of a subquery is to retrieve a list of values that is used as a list of acceptable or non-acceptable criteria by the outer query.</p> <p>To see all the student Names that have made payments</p> <p>[[code quote]]</p> <p>Breaking it down …</p> <ol><li>Subquery executes first selecting all the studentID's in the payment table.</li> <li>Those The outer query executes using those StudentID's as part of the criteria in the where clause.</li></ol> <p>What happens when you run this Select statement?</p> <p>[[code quote]]</p> <p>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , &gt;, &gt;= or when the subquery is used as an expression.</p> <p>Remember, when using = there must be only one value on each side. If the subquery might return more than one value then you must use IN</p> <p>What if I wanted to see all students that have never made a payment?</p> <p>[[code quote]]</p> <p>Extra Geek point!</p> <p>In the previous example when the subquery selects all the StudentID's from the payment table you end up with a lot of duplicate StudentID values. This may seem inefficient when you could write the subquery like this:</p> <p>[[code quote]]</p> <p>Remember, distinct only returns unique values and not duplicate. Actual testing reveals that using distinct in the subquery to return unique values is actually slower. Keep in mind, that there is some overhead in the selecting of only distinct values VS simply selecting all of them.</p> <p>Any, Some and All Operators</p> <p>So far our subqueries have returned values to be used as criteria for an exact match by the outer query.</p> <p>[[code quote]]</p> <p>What if we want something other than an exact match?</p> <p>The ANY or SOME (for SQL they are interchangeable) operators lets you use even more operators (&gt;, &lt;,&gt;=, &lt;=, &lt;&gt;).</p> <p>SOME compares against any of the values retrieved by the subquery</p> <p>[[code quote]]</p> <p>If the Grade being selected by the outer query is greater than any of the grades returned by the subquery then the record is returned.</p> <p>The ALL operator compares against all of the values retrieved by the subquery</p> <p>[[code quote]]</p> <p>If the Grade being selected by the outer query is greater than all of the grades returned by the subquery then the record is returned.</p> <p>We can use these operators to perform some more complicate selects. Subqueries can be used in many places where you need to retrieve a set of values for criteria.</p> <p>Select the City that has the highest number of students in it.</p> <p>[[code quote]]</p> <p>In this example we used the subquery as criteria in the having clause.</p> <p>Breaking it down:</p> <ol><li>Subquery executes first and returns values. [[code quote]]</li> <li>Outer query executes comparing the count of students in each city to see which count(s) are greater/equal than or equal to all the ones in the subquery. The record from the outer query that is equal to the highest one in the subquery is the city with the most students.</li></ol> <p>Correlated Subqueries</p> <p>We do not cover correlated subqueries in this course. However, here is a brief introduction</p> <p>Correlated subqueries are a bit different than the queries we have looked at so far. These were called nested subqueries.</p> <p>Nested subqueries had the subquery query execute once and then the outer query executed once.</p> <p>Correleated subqueries work like this:</p> <ol><li>The outer query retrieves a record</li> <li>The subquery executes using data passed to it from the record retrieved by the outer query.</li> <li>The subquery passes databack to the outer query. This data is used by the outer query to finish processing the record.</li></ol> <p>The process repeats for every record processed by the outerquery.</p> <p>The hallmark of the correlated subquery is that the subquery references (uses data from) a table specified in the outer query's from clause.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/SQL/outerJoins.html" class="prev">
          Outer Joins
        </a></span> <span class="next"><a href="/SQL/unions.html">
          Unions
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/26.3cf4d3e8.js" defer></script><script src="/assets/js/app.7cc1c6fa.js" defer></script>
  </body>
</html>

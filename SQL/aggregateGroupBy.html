<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Aggregates and Non-Aggregates | DMIT-1508 Student Notes</title>
    <meta name="description" content="Database Fundamentals">
    
    
    <link rel="preload" href="/assets/css/0.styles.16c91a8c.css" as="style"><link rel="preload" href="/assets/js/app.d5732d1b.js" as="script"><link rel="preload" href="/assets/js/32.ee7c2f39.js" as="script"><link rel="prefetch" href="/assets/js/14.0739af3f.js"><link rel="prefetch" href="/assets/js/1.c16dc73c.js"><link rel="prefetch" href="/assets/js/2.e6260b7e.js"><link rel="prefetch" href="/assets/js/3.2b24c117.js"><link rel="prefetch" href="/assets/js/4.57168093.js"><link rel="prefetch" href="/assets/js/5.aad14121.js"><link rel="prefetch" href="/assets/js/6.78b7e70e.js"><link rel="prefetch" href="/assets/js/7.f15f7865.js"><link rel="prefetch" href="/assets/js/8.446abc00.js"><link rel="prefetch" href="/assets/js/9.2b8e22e4.js"><link rel="prefetch" href="/assets/js/10.0b00e023.js"><link rel="prefetch" href="/assets/js/11.be3dead0.js"><link rel="prefetch" href="/assets/js/12.d1ee5732.js"><link rel="prefetch" href="/assets/js/13.fc5aefaf.js"><link rel="prefetch" href="/assets/js/15.b35599cd.js"><link rel="prefetch" href="/assets/js/16.e55fa65c.js"><link rel="prefetch" href="/assets/js/17.73c3e63b.js"><link rel="prefetch" href="/assets/js/18.d42200b5.js"><link rel="prefetch" href="/assets/js/19.e2e91e0c.js"><link rel="prefetch" href="/assets/js/20.43ac2804.js"><link rel="prefetch" href="/assets/js/21.be3290d7.js"><link rel="prefetch" href="/assets/js/22.af757ef7.js"><link rel="prefetch" href="/assets/js/23.7720f3b7.js"><link rel="prefetch" href="/assets/js/24.93a77b06.js"><link rel="prefetch" href="/assets/js/25.b136b5f3.js"><link rel="prefetch" href="/assets/js/26.89728bd1.js"><link rel="prefetch" href="/assets/js/27.b66a6264.js"><link rel="prefetch" href="/assets/js/28.e86d79a7.js"><link rel="prefetch" href="/assets/js/29.e9474769.js"><link rel="prefetch" href="/assets/js/30.61d6095f.js"><link rel="prefetch" href="/assets/js/31.57bbed33.js"><link rel="prefetch" href="/assets/js/33.dcf05549.js"><link rel="prefetch" href="/assets/js/34.040bcf50.js"><link rel="prefetch" href="/assets/js/35.0e03815e.js"><link rel="prefetch" href="/assets/js/36.d28f61b2.js"><link rel="prefetch" href="/assets/js/37.a48b6886.js"><link rel="prefetch" href="/assets/js/38.ffa6fb96.js"><link rel="prefetch" href="/assets/js/39.0d367d9d.js"><link rel="prefetch" href="/assets/js/40.1a7fbe8b.js"><link rel="prefetch" href="/assets/js/41.64d861a4.js"><link rel="prefetch" href="/assets/js/42.b6606b8f.js"><link rel="prefetch" href="/assets/js/43.b2aa50c4.js"><link rel="prefetch" href="/assets/js/44.48cd8145.js"><link rel="prefetch" href="/assets/js/45.23a5710a.js"><link rel="prefetch" href="/assets/js/46.88527d7a.js"><link rel="prefetch" href="/assets/js/47.835959b4.js"><link rel="prefetch" href="/assets/js/48.29f9399b.js"><link rel="prefetch" href="/assets/js/49.6039bc11.js"><link rel="prefetch" href="/assets/js/50.199a9c77.js"><link rel="prefetch" href="/assets/js/51.5e875b64.js"><link rel="prefetch" href="/assets/js/52.2f693d57.js"><link rel="prefetch" href="/assets/js/53.c54df658.js"><link rel="prefetch" href="/assets/js/54.63325dfd.js"><link rel="prefetch" href="/assets/js/55.ffecd9b1.js"><link rel="prefetch" href="/assets/js/56.a6bc72d9.js"><link rel="prefetch" href="/assets/js/57.747244cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.16c91a8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DMIT-1508 Student Notes</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Design/" class="nav-link">Normalization</a></div><div class="nav-item"><a href="/DDL/" class="nav-link">DDL</a></div><div class="nav-item"><a href="/DML/" class="nav-link">DML</a></div><div class="nav-item"><a href="/SQL/" class="nav-link router-link-active">SQL</a></div><div class="nav-item"><a href="/DCL/" class="nav-link">DCL</a></div><div class="nav-item"><a href="/about/slides-installing-sql-server.html" class="nav-link">MS SQL 2017</a></div><div class="nav-item"><a href="https://github.com/DMIT-1508/DMIT-1508.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Design/" class="nav-link">Normalization</a></div><div class="nav-item"><a href="/DDL/" class="nav-link">DDL</a></div><div class="nav-item"><a href="/DML/" class="nav-link">DML</a></div><div class="nav-item"><a href="/SQL/" class="nav-link router-link-active">SQL</a></div><div class="nav-item"><a href="/DCL/" class="nav-link">DCL</a></div><div class="nav-item"><a href="/about/slides-installing-sql-server.html" class="nav-link">MS SQL 2017</a></div><div class="nav-item"><a href="https://github.com/DMIT-1508/DMIT-1508.github.io/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/SQL/" class="sidebar-link">Simple SQL Queries</a></li><li><a href="/SQL/simpleQueries.html" class="sidebar-link">SIMPLE QUERY</a></li><li><a href="/SQL/stringFunctions.html" class="sidebar-link">String Functions</a></li><li><a href="/SQL/dateFunctions.html" class="sidebar-link">Date Functions</a></li><li><a href="/SQL/aggregateFunctions.html" class="sidebar-link">Aggregate Functions</a></li><li><a href="/SQL/aggregateGroupBy.html" class="active sidebar-link">Aggregates and Non-Aggregates</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SQL/aggregateGroupBy.html#group-by" class="sidebar-link">GROUP BY</a></li><li class="sidebar-sub-header"><a href="/SQL/aggregateGroupBy.html#having" class="sidebar-link">HAVING</a></li></ul></li><li><a href="/SQL/innerJoins.html" class="sidebar-link">Inner Joins</a></li><li><a href="/SQL/outerJoins.html" class="sidebar-link">Outer Joins</a></li><li><a href="/SQL/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/SQL/unions.html" class="sidebar-link">Unions</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="aggregates-and-non-aggregates"><a href="#aggregates-and-non-aggregates" aria-hidden="true" class="header-anchor">#</a> Aggregates and Non-Aggregates</h1> <ul><li>Mixing Aggregates and Non-Aggregates (Group-By)</li> <li>Simple examples</li> <li>Practice</li> <li>Practice Solution</li></ul> <hr> <h2 id="group-by"><a href="#group-by" aria-hidden="true" class="header-anchor">#</a> GROUP BY</h2> <p>The GROUP BY clause is used in conjunction with aggregate functions to provide subtotal calculations of the aggregate function. We could easily return the average Mark from the grade table. What if we wanted the average Mark for each Course? For each student? For each course for each student? To do this we would use GROUP BY.</p> <p>[[code quote]]</p> <p>Returns the average of all the marks in the Registration table.</p> <p>[[code quote]]</p> <p>Returns the average mark for each CourseID (GROUP BY CourseID) in the Registration Table. Another way to think of the syntax GROUP BY is the 'for each'.</p> <p>It is important to note that you cannot combine an aggregate column with a non-aggregate column(s) unless you group by all the non-aggregate columns in your query.</p> <p>[[code quote]]</p> <p>Column 'Registration.CourseId' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p> <p>Remember that an aggregate returns one calculated value. How can it return the average mark for the Reigstration table (one value) as well as each course ID that is in the Registration table (many values). It simply does not make sense and cannot be done. So the error you see above reminds you that you must group by all the columns you are using in your query that are not part of the aggregate function. In this case, CourseID.</p> <h2 id="having"><a href="#having" aria-hidden="true" class="header-anchor">#</a> HAVING</h2> <p>Having is like the where clause. Except, it applies its criteria after group by has grouped its aggregate data. With the GROUP BY clause we selected the average mark of CourseID. What if we only wanted to return the CourseID's and average mark for courses that have averages that are greater than 80?</p> <p>[[code quote]]</p> <p>Incorrect syntax near the keyword 'where'.</p> <p>Fails because the where clause must be before the Group By Clause. Remember, a query does not need to use all the clauses but they must be in the right order!</p> <p>[[code quote]]</p> <p>An aggregate may not appear in the WHERE clause unless it is in a subquery contained in a HAVING clause or a select list, and the column being aggregated is an outer reference.</p> <p>Fails because and aggregate cannot be in a where clause. It also does not really make sense. It is not possible to return only the CourseID's that have average over 80 until all the Course averages have been calculated. And that is done by the Group By Clause. So, the Group By Clause must execute before the criteria is applied to return only the CourseID's with averages over 80.</p> <p>[[code quote]]</p> <p>Works!The Select with the group by selects the averages for each course and then the having clause returns only the ones whose average was over 80.</p> <p>What if we only wanted to return the CourseID's that have averages over 80 and did not want the actual average returned. Simply do not select the AVG(Mark). Remember, what we select (return to the user) does not have to match columns used in the where or having clauses.</p> <p>[[code quote]]</p> <p>Works!</p> <p>Having is used with aggregate functions only. It is used to apply where clause functionality AFTER the aggregate function and group by has occured. Only use having in this situation. For queries without a group by clause you should use the WHERE clause.</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/SQL/aggregateFunctions.html" class="prev">
          Aggregate Functions
        </a></span> <span class="next"><a href="/SQL/innerJoins.html">
          Inner Joins
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/32.ee7c2f39.js" defer></script><script src="/assets/js/app.d5732d1b.js" defer></script>
  </body>
</html>
